




	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="K-State CIS 300: Data Structures">
    <meta name="author" content="Rod Howell and Josh Weese">
    <title>Enumerators :: Data Structures in C#</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/fontawesome-all.min.css?1686149327" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis300/css/fontawesome-all.min.css?1686149327" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/featherlight.min.css?1686149327" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis300/css/featherlight.min.css?1686149327" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/auto-complete.css?1686149327" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis300/css/auto-complete.css?1686149327" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/perfect-scrollbar.min.css?1686149327" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/nucleus.css?1686149327" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/fonts.css?1686149327" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis300/css/fonts.css?1686149327" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/theme.css?1686149327" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/theme-light-theme.css?1686149327" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/ie.css?1686149327" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/variant.css?1686149327" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/print.css?1686149327" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/variant.js?1686149327"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cis300/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cis300/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis300/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis300/css/custom.css?1686149327" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/jquery.min.js?1686149327" defer></script>

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis300/appendix/syntax/enumerators/embed.html">
    <div id="body" class="default-animation" data-iframe-height="yes">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1" data-iframe-height="yes" style="padding-bottom: 0px">
        <div class="flex-block-wrapper" data-iframe-height="yes">
          <div id="head-tags">
          </div>
          <article class="default">
    
    
    
<h2 id="enumerators">Enumerators</h2>
<p>As we saw in 

<a href="https://ksu-cs-textbooks.github.io/cis300/appendix/syntax/foreach">the previous section</a>, in order for a data structure to support a <strong>foreach</strong> loop, it must be a subtype of either 

<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.ienumerable?view=net-6.0" target="_blank" rel="noopener"><strong>IEnumerable</strong></a> or 

<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1?view=net-6.0" target="_blank" rel="noopener"><strong>IEnumerable&lt;T&gt;</strong></a>, where <strong>T</strong> is the type of the elements in the data structure. Thus, because 

<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2?view=net-6.0" target="_blank" rel="noopener"><strong>Dictionary&lt;TKey, TValue&gt;</strong></a> is a subtype of <strong>IEnumerable&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;</strong>, we can use a <strong>foreach</strong> loop to iterate through the key-value pairs that it stores. Likewise, because its 

<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.keys?view=net-6.0#system-collections-generic-dictionary-2-keys" target="_blank" rel="noopener"><strong>Keys</strong></a> and 

<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.values?view=net-6.0#system-collections-generic-dictionary-2-values" target="_blank" rel="noopener"><strong>Values</strong></a> properties get objects that are subtypes of <strong>IEnumerable&lt;TKey&gt;</strong> and <strong>IEnumerable&lt;TValue&gt;</strong>, respectively, <strong>foreach</strong> loops may be used to iterate through these objects as well, in order to process all the keys or all the values stored in the dictionary. <strong>IEnumerable</strong> and <strong>IEnumerable&lt;T&gt;</strong> are 

<a href="https://ksu-cs-textbooks.github.io/cis300/trees/tries/multiple-impl">interfaces</a>; hence, we must define any subtypes so that they implement these interfaces. In this section, we will show how to implement the <strong>IEnumerable&lt;T&gt;</strong> interface to support a <strong>foreach</strong> loop.</p>
<p>The <strong>IEnumerable&lt;T&gt;</strong> interface requires two methods:</p>
<ul>
<li><strong>public IEnumerator&lt;T&gt; GetEnumerator()</strong></li>
<li><strong>IEnumerator IEnumerable.GetEnumerator()</strong></li>
</ul>
<p>The latter method is required only because <strong>IEnumerable&lt;T&gt;</strong> is a subtype of <strong>IEnumerable</strong>, and that interface requires a <strong>GetEnumerator</strong> method that returns a non-generic <strong>IEnumerator</strong>. Both of these methods should return the same object; hence, because <strong>IEnumerator&lt;T&gt;</strong> is also a subtype of <strong>IEnumerator</strong>, this method can simply call the first method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>IEnumerator IEnumerable.GetEnumerator()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> GetEnumerator();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <strong>public GetEnumerator</strong> method returns an <strong>IEnumerator&lt;T&gt;</strong>. In order to get instances of this interface, we could define a class that implements it; however, C# provides a simpler way to define a subtype of this interface, or, when needed, the <strong>IEnumerable&lt;T&gt;</strong> interface.</p>
<p>Defining such an enumerator is as simple as writing code to iterate through the elements of the data structure. As each element is reached, it is enumerated via a <strong>yield return</strong> statement. For example, suppose a dictionary implementation uses a <strong>List&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;</strong> called <code>_elements</code> to store its key-value pairs. We can then define its <strong>GetEnumerator</strong> method as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> IEnumerator&lt;KeyValuePair&lt;TKey, TValue&gt;&gt; GetEnumerator()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span> (KeyValuePair&lt;TKey, TValue&gt; p <span style="color:#66d9ef">in</span> _elements)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> p;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Suppose user code contains a <strong>Dictionary&lt;string, int&gt;</strong> called <code>d</code> and a <strong>foreach</strong> loop structured as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> (KeyValuePair&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">int</span>&gt; x <span style="color:#66d9ef">in</span> d)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then the <strong>GetEnumerator</strong> method is executed until the <strong>yield return</strong> is reached. The state of this method is then saved, and the value <code>p</code> is used as the value for <code>x</code> in the first iteration of the <strong>foreach</strong> in the user code. When this loop reaches its second iteration, the <strong>GetEnumerator</strong> method resumes its execution until it reaches the <strong>yield return</strong> a second time, and again, the current value of <code>p</code> is used as the value of <code>x</code> in the second iteration of the loop in user code. This continues until the <strong>GetEnumerator</strong> method finishes; at this point, the loop in user code terminates.</p>
<p>Before continuing, we should mention that there is a simpler way of implementing the <strong>public GetEnumerator</strong> method in the above example. Because <strong>List&lt;T&gt;</strong> implements <strong>IEnumerable&lt;T&gt;</strong>, we can simply use its enumerator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> IEnumerator&gt; GetEnumerator()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> _elements.GetEnumerator();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>However, the first solution illustrates a more general technique that can be used when we don&rsquo;t have the desired enumerator already available. For instance, continuing the above example, suppose we wish to define a <strong>Keys</strong> property to get an <strong>IEnumerable&lt;TKey&gt;</strong> that iterates through the keys in the dictionary. Because the dictionary now supports a <strong>foreach</strong> loop, we can define this code to iterate through the key-value pairs in the dictionary, rather than the key-value pairs stored in the <strong>List&lt;KeyVauePair&lt;TKey, TValue&gt;&gt;</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> IEnumerable&lt;TKey&gt; Keys
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">get</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> (KeyValuePair&lt;TKey, TValue&gt; p <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> p.Key;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The above code is more maintainable than iterating through the <strong>List&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;</strong> as it doesn&rsquo;t depend on the specific implementation of the dictionary.</p>
<p>While this technique usually works best with iterative code, it can also be used with recursion, although the translation usually ends up being less direct and less efficient. Suppose, for example, our dictionary were implemented as in 

<a href="https://ksu-cs-textbooks.github.io/cis300/trees/bst">&ldquo;Binary Search Trees&rdquo;</a>, where a binary search tree is used. The idea is to adapt the 

<a href="https://ksu-cs-textbooks.github.io/cis300/trees/bst/inorder">inorder traversal</a> algorithm. However, we can&rsquo;t use this directly to implement a recursive version of the <strong>GetEnumerator</strong> method because this method does not take any parameters; hence, we can&rsquo;t apply it to arbitrary subtrees. Instead, we need a separate recursive method that takes a <strong>BinaryTreeNode&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;</strong> as its parameter and returns the enumerator we need. Another problem, though, is that the recursive calls will no longer do the processing that needs to be done on the children - they will simply return enumerators. We therefore need to iterate through each of these enumerators to include their elements in the enumerator we are returning:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;
</span></span><span style="display:flex;"><span>    GetEnumerable(BinaryTreeNode&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;? t)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (t != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> (KeyValuePair&lt;TKey, TValue&gt; p <span style="color:#66d9ef">in</span> GetEnumerable(t.LeftChild))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> p;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> t.Data;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> (KeyValuePair&lt;TKey, TValue&gt; p <span style="color:#66d9ef">in</span> GetEnumerable(t.RightChild))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> p;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Note that we&rsquo;ve made the return type of this method <strong>IEnumerable&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;</strong> because we need to use a <strong>foreach</strong> loop on the result of the recursive calls. Then because any instance of this type must have a <strong>GetEnumerator</strong> method, we can implement the <strong>GetEnumerator</strong> method for the dictionary as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> IEnumerator&lt;KeyValuePair&lt;TKey, TValue&gt;&gt; GetEnumerator()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> GetEnumerable(_elements).GetEnumerator();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In transforming the inorder traversal into the above code, we have introduced some extra loops. These loops lead to less efficient code. Specifically, if the binary search tree is an AVL tree or other balanced binary tree, the time to iterate through this enumerator is in <span style="white-space:nowrap">
<span class="math align-center">$ O(n \lg n) $</span>,</span> where 
<span class="math align-center">$ n $</span> is the number of nodes in the tree. The inorder traversal, by contrast, runs in 
<span class="math align-center">$ O(n) $</span> time. In order to achieve this running time with an enumerator, we need to translate the inorder traversal to iterative code using a stack. However, this code isn&rsquo;t easy to understand:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> IEnumerator&lt;KeyValuePair&lt;TKey, TValue&gt;&gt; GetEnumerator()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Stack&lt;BinaryTreeNode&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;&gt; s = <span style="color:#66d9ef">new</span>();
</span></span><span style="display:flex;"><span>    BinaryTreeNode&lt;KeyValuePair&lt;TKey, TValue&gt;&gt;? t = _elements;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (t != <span style="color:#66d9ef">null</span> || s.Count &gt; <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (t != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            s.Push(t);
</span></span><span style="display:flex;"><span>            t = t.LeftChild;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        t = s.Pop();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">return</span> t.Data;
</span></span><span style="display:flex;"><span>        t = t.RightChild;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/clipboard.min.js?1686149327" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/featherlight.min.js?1686149327" defer></script>
    <script>
      function useMathJax( config ){
        if( !Object.assign ){
          
          return;
        }
        window.MathJax = Object.assign( window.MathJax || {}, {
          loader: {
            load: ['[tex]/mhchem']
          },
          startup: {
            elements: [
              '.math'
            ]
          },
          tex: {
            inlineMath: [
              ['$', '$'], 
              ['\\(', '\\)']
            ]
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://ksu-cs-textbooks.github.io/cis300/js/mathjax/tex-mml-chtml.js?1686149327"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/theme.js?1686149327" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis300/js/embed-iframe.js?1686149327 defer"></script>
    <script src="https://cdn.jsdelivr.net/npm/iframe-resizer@4.3.2/js/iframeResizer.contentWindow.min.js"></script>
    
  </body>
</html>
